{% extends "base.html" %}

{% block title %}Subjects - Ultimate Tutor Platform{% endblock %}

{% block breadcrumbs %}
{% include 'partials/_breadcrumbs.html' with breadcrumbs=[
    {'title': 'Home', 'url': '/'},
    {'title': 'Subjects', 'url': '#'}
] %}
{% endblock %}

{% block content %}
<div class="fade-in">
    <!-- Page Header -->
    <div class="text-center mb-12">
        <h1 class="heading-1 gradient-text mb-4">Explore Subjects</h1>
        <p class="text-xl text-dark-300 max-w-2xl mx-auto">
            Comprehensive K-12 curriculum covering all core subjects and enrichment areas
        </p>
    </div>
    
    <!-- Search Bar -->
    <div class="max-w-2xl mx-auto mb-12">
        <div class="relative">
            <input 
                type="text" 
                id="subject-search" 
                placeholder="Search subjects..." 
                class="input-modern pl-12"
                onkeyup="filterSubjects()"
            >
            <i class="fas fa-search absolute left-4 top-1/2 transform -translate-y-1/2 text-dark-500"></i>
        </div>
    </div>
    
    <!-- Subjects Grid -->
    <div class="grid-responsive" id="subjects-grid">
        {% for subject in subjects %}
        <div class="subject-card-item" data-name="{{ subject.name.lower() }}" data-description="{{ subject.description.lower() }}">
            {% include 'partials/_subject_card.html' with subject=subject %}
        </div>
        {% else %}
        {% include 'partials/_empty_state.html' with 
            icon='ðŸ“š',
            title='No Subjects Available',
            message='Subjects will be loaded soon. Check back later!',
            button_text='Go Home',
            button_href='/'
        %}
        {% endfor %}
    </div>
    
    <!-- Statistics -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-16">
        <div class="card-modern text-center">
            <div class="text-4xl mb-3">ðŸ“š</div>
            <div class="text-3xl font-bold gradient-text mb-2">{{ subjects|length }}</div>
            <div class="text-dark-400">Total Subjects</div>
        </div>
        <div class="card-modern text-center">
            <div class="text-4xl mb-3">ðŸ“–</div>
            <div class="text-3xl font-bold gradient-text mb-2" id="total-topics">0</div>
            <div class="text-dark-400">Total Topics</div>
        </div>
        <div class="card-modern text-center">
            <div class="text-4xl mb-3">ðŸŽ¯</div>
            <div class="text-3xl font-bold gradient-text mb-2" id="total-lessons">0</div>
            <div class="text-dark-400">Total Lessons</div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function filterSubjects() {
    const searchTerm = document.getElementById('subject-search').value.toLowerCase();
    const subjects = document.querySelectorAll('.subject-card-item');
    
    subjects.forEach(subject => {
        const name = subject.dataset.name;
        const description = subject.dataset.description;
        
        if (name.includes(searchTerm) || description.includes(searchTerm)) {
            subject.style.display = '';
        } else {
            subject.style.display = 'none';
        }
    });
}

// Load statistics
async function loadStats() {
    try {
        const response = await fetch('/api/subjects');
        const subjects = await response.json();
        
        let totalTopics = 0;
        let totalLessons = 0;
        
        for (const subject of subjects) {
            const topicsResponse = await fetch(`/api/subject/${subject.id}/topics`);
            const topics = await topicsResponse.json();
            totalTopics += topics.length;
            
            for (const topic of topics) {
                const lessonsResponse = await fetch(`/api/topic/${topic.id}/lessons`);
                const lessons = await lessonsResponse.json();
                totalLessons += lessons.length;
            }
        }
        
        document.getElementById('total-topics').textContent = totalTopics;
        document.getElementById('total-lessons').textContent = totalLessons;
    } catch (error) {
        console.error('Error loading stats:', error);
    }
}

document.addEventListener('DOMContentLoaded', () => {
    loadStats();
});
</script>
{% endblock %}