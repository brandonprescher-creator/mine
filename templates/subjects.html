{% extends "base.html" %}

{% block title %}Subjects - Ultimate Tutor Platform{% endblock %}

{% block breadcrumbs %}
{% set breadcrumbs = [
    {'title': 'Home', 'url': '/'},
    {'title': 'Subjects', 'url': '#'}
] %}
{% include 'partials/_breadcrumbs.html' %}
{% endblock %}

{% block content %}
<div class="fade-in">
    <!-- Page Header -->
    <div class="text-center mb-12">
        <h1 class="heading-1 gradient-text mb-4">Explore Subjects</h1>
        <p class="text-xl text-dark-300 max-w-2xl mx-auto">
            Comprehensive K-12 curriculum covering all core subjects and enrichment areas
        </p>
    </div>
    
    <!-- Search Bar -->
    <div class="max-w-2xl mx-auto mb-12">
        <div class="relative">
            <input 
                type="text" 
                id="subject-search" 
                placeholder="Search subjects..." 
                class="input-modern pl-12"
                onkeyup="filterSubjects()"
            >
            <i class="fas fa-search absolute left-4 top-1/2 transform -translate-y-1/2 text-dark-500"></i>
        </div>
    </div>
    
    <!-- Subjects Grid -->
    <div class="grid-responsive" id="subjects-grid">
        {% for subject in subjects %}
        <div class="subject-card-item" data-name="{{ subject.name.lower() }}" data-description="{{ subject.description.lower() }}">
            <div class="card-modern subject-card group cursor-pointer" onclick="window.location.href='/subject/{{ subject.id }}'">
                <div class="relative z-10">
                    <div class="text-6xl mb-4 transform group-hover:scale-110 transition-transform">
                        {{ subject.icon }}
                    </div>
                    <h3 class="text-2xl font-bold mb-3 group-hover:text-primary-400 transition-colors">
                        {{ subject.name }}
                    </h3>
                    <p class="text-dark-400 text-sm mb-4">
                        {{ subject.description }}
                    </p>
                    <div class="flex items-center justify-between">
                        <span class="badge badge-primary">
                            <i class="fas fa-book mr-1"></i>
                            {{ subject.topic_count if subject.topic_count else 0 }} Topics
                        </span>
                        <i class="fas fa-arrow-right text-primary-400 opacity-0 group-hover:opacity-100 transition-opacity"></i>
                    </div>
                </div>
            </div>
        </div>
        {% else %}
        <div class="empty-state">
            <div class="empty-state-icon">ðŸ“š</div>
            <h3 class="text-xl font-semibold mb-2 text-dark-300">No Subjects Available</h3>
            <p class="text-dark-500 mb-6">Subjects will be loaded soon. Check back later!</p>
            <button class="btn btn-primary" onclick="window.location.href='/'">
                <i class="fas fa-home mr-2"></i>
                Go Home
            </button>
        </div>
        {% endfor %}
    </div>
    
    <!-- Statistics -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-16">
        <div class="card-modern text-center">
            <div class="text-4xl mb-3">ðŸ“š</div>
            <div class="text-3xl font-bold gradient-text mb-2">{{ subjects|length }}</div>
            <div class="text-dark-400">Total Subjects</div>
        </div>
        <div class="card-modern text-center">
            <div class="text-4xl mb-3">ðŸ“–</div>
            <div class="text-3xl font-bold gradient-text mb-2" id="total-topics">0</div>
            <div class="text-dark-400">Total Topics</div>
        </div>
        <div class="card-modern text-center">
            <div class="text-4xl mb-3">ðŸŽ¯</div>
            <div class="text-3xl font-bold gradient-text mb-2" id="total-lessons">0</div>
            <div class="text-dark-400">Total Lessons</div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function filterSubjects() {
    const searchTerm = document.getElementById('subject-search').value.toLowerCase();
    const subjects = document.querySelectorAll('.subject-card-item');
    
    subjects.forEach(subject => {
        const name = subject.dataset.name;
        const description = subject.dataset.description;
        
        if (name.includes(searchTerm) || description.includes(searchTerm)) {
            subject.style.display = '';
        } else {
            subject.style.display = 'none';
        }
    });
}

// Load statistics
async function loadStats() {
    try {
        const response = await fetch('/api/subjects');
        const subjects = await response.json();
        
        let totalTopics = 0;
        let totalLessons = 0;
        
        for (const subject of subjects) {
            const topicsResponse = await fetch(`/api/subject/${subject.id}/topics`);
            const topics = await topicsResponse.json();
            totalTopics += topics.length;
            
            for (const topic of topics) {
                const lessonsResponse = await fetch(`/api/topic/${topic.id}/lessons`);
                const lessons = await lessonsResponse.json();
                totalLessons += lessons.length;
            }
        }
        
        document.getElementById('total-topics').textContent = totalTopics;
        document.getElementById('total-lessons').textContent = totalLessons;
    } catch (error) {
        console.error('Error loading stats:', error);
    }
}

document.addEventListener('DOMContentLoaded', () => {
    loadStats();
});
</script>
{% endblock %}