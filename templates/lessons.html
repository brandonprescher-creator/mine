{% extends "base.html" %}

{% block title %}{{ topic.name }} - Lessons{% endblock %}

{% block breadcrumbs %}
{% set breadcrumbs = [
    {'title': 'Home', 'url': '/'},
    {'title': 'Subjects', 'url': '/subjects'},
    {'title': topic.subject_name, 'url': '/subject/' + (topic.subject_id|string)},
    {'title': topic.name, 'url': '#'}
] %}
{% include 'partials/_breadcrumbs.html' %}
{% endblock %}

{% block content %}
<div class="fade-in">
    <!-- Topic Header -->
    <div class="card-glass p-8 mb-8">
        <h1 class="heading-2 gradient-text mb-3">{{ topic.name }}</h1>
        <p class="text-dark-300 text-lg">{{ topic.description }}</p>
    </div>
    
    <!-- Lessons List -->
    {% if lessons %}
    <div class="mb-8">
        <h2 class="text-2xl font-bold mb-6">Available Lessons</h2>
        <div class="space-y-4">
            {% for lesson in lessons %}
            <div class="card-modern group cursor-pointer" onclick="window.location.href='/lesson/{{ lesson.id }}'">
                <div class="flex justify-between items-start mb-3">
                    <h3 class="text-lg font-bold group-hover:text-primary-400 transition-colors flex-1">
                        {{ lesson.title }}
                    </h3>
                    <span class="badge badge-{{ lesson.difficulty if lesson.difficulty else 'primary' }} ml-2">
                        {{ lesson.difficulty|upper if lesson.difficulty else 'MEDIUM' }}
                    </span>
                </div>
                
                <p class="text-dark-400 text-sm mb-4">
                    {{ lesson.description[:150] + '...' if lesson.description|length > 150 else lesson.description }}
                </p>
                
                <div class="flex items-center justify-between text-sm text-dark-500">
                    <div class="flex items-center space-x-4">
                        <span><i class="fas fa-list-ol mr-1"></i> {{ lesson.steps|length if lesson.steps else 0 }} Steps</span>
                        <span><i class="fas fa-puzzle-piece mr-1"></i> {{ lesson.problem_count if lesson.problem_count else 0 }} Problems</span>
                    </div>
                    {% if lesson.progress %}
                    <span class="badge badge-success">
                        <i class="fas fa-check mr-1"></i> {{ lesson.progress }}%
                    </span>
                    {% endif %}
                </div>
                
                {% if lesson.progress %}
                <div class="mt-3">
                    <div class="progress-bar">
                        <div class="progress-bar-fill" style="width: {{ lesson.progress }}%"></div>
                    </div>
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>
    {% else %}
    <div class="empty-state">
        <div class="empty-state-icon">üìö</div>
        <h3 class="text-xl font-semibold mb-2 text-dark-300">No Lessons Available</h3>
        <p class="text-dark-500 mb-6">Lessons for this topic are being developed.</p>
        <button class="btn btn-primary" onclick="history.back()">
            <i class="fas fa-arrow-left mr-2"></i>
            Back to Topics
        </button>
    </div>
    {% endif %}
    
    <!-- Practice Section -->
    <div class="card-modern mb-8">
        <h3 class="text-xl font-bold mb-4">Practice All</h3>
        <p class="text-dark-400 mb-4">
            Test your knowledge across all lessons in this topic with mixed practice problems
        </p>
        <button class="btn btn-primary" onclick="startMixedPractice()">
            <i class="fas fa-dumbbell mr-2"></i>
            Start Mixed Practice
        </button>
    </div>
    
    <!-- Progress Overview -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div class="card-modern text-center">
            <div class="text-4xl mb-3">‚úÖ</div>
            <div class="text-3xl font-bold gradient-text mb-2" id="completed-lessons">0</div>
            <div class="text-dark-400">Lessons Completed</div>
        </div>
        <div class="card-modern text-center">
            <div class="text-4xl mb-3">üéØ</div>
            <div class="text-3xl font-bold gradient-text mb-2" id="problems-solved">0</div>
            <div class="text-dark-400">Problems Solved</div>
        </div>
        <div class="card-modern text-center">
            <div class="text-4xl mb-3">‚≠ê</div>
            <div class="text-3xl font-bold gradient-text mb-2" id="mastery-score">0%</div>
            <div class="text-dark-400">Mastery Score</div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function startMixedPractice() {
    const topicId = {{ topic.id }};
    window.location.href = `/practice/topic/${topicId}`;
}

// Load progress stats
async function loadProgress() {
    try {
        const topicId = {{ topic.id }};
        // This would call a backend endpoint for topic progress
        // For now, using placeholder values
        document.getElementById('completed-lessons').textContent = '0';
        document.getElementById('problems-solved').textContent = '0';
        document.getElementById('mastery-score').textContent = '0%';
    } catch (error) {
        console.error('Error loading progress:', error);
    }
}

document.addEventListener('DOMContentLoaded', () => {
    loadProgress();
});
</script>
{% endblock %}